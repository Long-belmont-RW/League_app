# Mobile-Friendly Lineup Manager Changes

This document outlines the changes made to implement the mobile-friendly lineup manager, following the plan detailed in `mobile_friendly_plan.md`.

## Phase 1: Responsive Layout and Controls (CSS)

1.  **Created `static/css/lineup-responsive.css`:**
    -   A new CSS file was created to house responsive styles for the lineup manager.
    -   It includes media queries to adjust the `pitch-grid`, `player-slot`, and `player-card` sizes for smaller screens (`max-width: 768px` and `max-width: 480px`).

2.  **Modified `league/templates/manage_lineup_redesigned.html`:**
    -   Removed the inline `<style>` block containing pitch-related CSS.
    -   Added a link to the newly created `lineup-responsive.css` file using `{% static 'css/lineup-responsive.css' %}`.

3.  **Modified `league/templates/partials/team_lineup_panel.html`:**
    -   **Collapsible Available Players List:** The "Available Players" list was wrapped in a new `div` with `id="{{ team_prefix }}-available-players-wrapper"`.
    -   A button with `id="{{ team_prefix }}-toggle-available"` was added above the "Available Players" list to toggle its visibility.
    -   A basic JavaScript snippet was embedded at the end of the template to handle the toggling of the available players list, initially hiding it on screens smaller than 768px.
    -   **Responsive Controls:** Applied Tailwind CSS classes (`flex-col sm:flex-row`, `gap-2 sm:gap-4`, `text-base sm:text-lg`, `w-full sm:w-auto`) to the formation `select` dropdown and "Save Lineup" `button` to make them larger and stack vertically on small screens, improving touch-friendliness.

## Phase 2: Touch-Friendly Interactions (JavaScript)

1.  **Modified `static/js/lineup-manager.js`:**
    -   **`selectedPlayerFigurine` property:** Added `this.selectedPlayerFigurine = null;` to the `LineupManager` constructor to track the currently selected player for tap-to-move.
    -   **`init()` method:** Added a call to `this.setupTapToMove();` within the `if (this.canEdit)` block to initialize the new interaction.
    -   **`createPitchSlot()` method:** Added a click event listener `slot.addEventListener("click", (e) => this.handleSlotClick(e));` to each pitch slot.
    -   **`createPlayerFigurine()` method:** Added a click event listener `figurine.addEventListener("click", (e) => this.handlePlayerFigurineClick(e));` to each player figurine.
    -   **New Methods for Tap-to-Move:**
        -   `setupTapToMove()`: Initializes click listeners for the substitutes and available players zones to handle moving selected players.
        -   `handlePlayerFigurineClick(e)`: Toggles player selection and visual highlighting.
        -   `handleSlotClick(e)`: Handles moving a selected player to an empty slot or swapping players if the slot is occupied.
        -   `selectPlayer(figurine)`: Adds a `selected-player` class for visual feedback and calls `highlightValidDestinations()`.
        -   `deselectPlayer()`: Removes the `selected-player` class and calls `clearValidDestinations()`.
        -   `movePlayer(playerFigurine, targetContainer)`: Handles the DOM manipulation for moving a player and updates the internal `starters`, `substitutes`, and `availablePlayers` arrays. Also updates `slot-occupied` classes and calls `updateCounts()` and `validateLineup()`.
        -   `highlightValidDestinations()`: Adds a `highlight-destination` class to empty pitch slots, substitutes zone, and available players zone.
        -   `clearValidDestinations()`: Removes the `highlight-destination` class from all potential destinations.

## Phase 3: Performance and UI Polish

1.  **Modified `league/templates/partials/team_lineup_panel.html`:**
    -   **Player Search Input:** Added an `<input type="text" id="{{ team_prefix }}-player-search" placeholder="Search players..." ...>` field just above the "Available Players" list.

2.  **Modified `static/js/lineup-manager.js`:**
    -   **`playerSearchInput` property:** Added `this.playerSearchInput` to the constructor to get a reference to the new search input.
    -   **`setupPlayerSearch()` method:** Added this new method, called in `init()`, which attaches a `keyup` event listener to the search input. It calls `renderAvailablePlayers()` with the current search term.
    -   **`renderAvailablePlayers(searchTerm = '')` method:** Modified to accept an optional `searchTerm`. It now filters the `this.availablePlayers` array based on the `full_name` or `last_name` matching the search term (case-insensitive) before rendering the figurines. If no players match, it displays a "No matching players found" message.

