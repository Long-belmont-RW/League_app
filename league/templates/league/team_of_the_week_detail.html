{% extends 'base.html' %}
{% load static %}
{% load league_extras %}

{% block title %}Team of the Week{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/lineup-styles.css' %}">
<style>
    .pitch-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        background-color: #2d9e4f;
        background-image: url('{% static "images/pitch.svg" %}');
        background-size: cover;
        aspect-ratio: 7 / 10;
        border: 4px solid white;
        border-radius: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-8">Team of the Week</h1>

    <div class="flex justify-center mb-8 gap-4">
        <form method="get" action="{% url 'team_of_the_week' %}" class="flex items-center gap-4">
            <select name="league" class="bg-gray-800 text-white p-2 rounded">
                <option value="">Select League</option>
                {% for league in leagues %}
                    <option value="{{ league.id }}" {% if league.id == selected_league %}selected{% endif %}>{{ league.name }}</option>
                {% endfor %}
            </select>
            <select name="week" class="bg-gray-800 text-white p-2 rounded">
                <option value="">Select Week</option>
                {% for week in weeks %}
                    <option value="{{ week }}" {% if week == selected_week %}selected{% endif %}>Week {{ week }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                View
            </button>
        </form>
    </div>

    {% if team_of_the_week %}
        <div class="pitch-container">
            <div class="relative h-full flex flex-col justify-around py-4 px-2">
                {% for player in team_of_the_week.teamoftheweekplayer_set.all|group_by:"position" %}
                    <div class="pitch-row flex justify-around">
                        {% for p in player.list %}
                            <div class="player-figurine">
                                <div class="jersey-container">
                                    <div class="jersey position-{{ p.position }}">
                                        {% include "partials/jersey.svg" %}
                                    </div>
                                    <div class="jersey-number">{{ p.player.jersey_number }}</div>
                                </div>
                                <div class="player-name-label">{{ p.player.last_name }}</div>
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <p class="text-center text-gray-500">No Team of the Week found for the selected league and week.</p>
    {% endif %}
</div>
{% endblock %}
